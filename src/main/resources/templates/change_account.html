<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>하나 보험</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      font-family: "Inter-Regular", Helvetica, sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background-color: #fffdfd;
      border-bottom: 1px solid #ddd;
    }

    .header .left-section {
      display: flex;
      align-items: center;
      font-size: 30px;
      flex: 1;
      font-weight: 800;
    }

    .header .left-section img {
      height: 40px;
      margin-right: 10px;
    }

    .header .right-section {
      display: flex;
      gap: 20px;
      align-items: center;
      font-size: 20px;
    }

    .header .right-section .menu {
      display: flex;
      gap: 40px;
    }

    .header .right-section .menu a {
      text-decoration: none;
      color: #008080;
      font-weight: bold;
      transition: color 0.3s ease;
    }

    .header .right-section .menu a:hover {
      color: #004d4d;
    }

    .header .right-section .logout {
      background-color: #014242;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      text-decoration: none;
      font-size: 14px;
    }

    .main-search {
      height: 20px;
      margin-left: 10px;
    }

    .all-menu-icon {
      height: 20px;
      margin-left: 10px;
    }

    .header-mini-bar {
      width: 100%;
      height: 30px;
      background-color: #f0f0f0;
      display: flex;
      align-items: center;
      padding: 0 20px;
    }

    .header-mini-bar .menu {
      display: flex;
      gap: 20px;
    }

    .header-mini-bar .menu a {
      text-decoration: none;
      color: #000;
      font-weight: bold;
    }

    .header-mini-bar .menu a:hover {
      color: #004d4d;
    }

    .main {
      display: flex;
      justify-content: center;
      padding: 20px;
      background-color: #ffffff;
      height: calc(100vh - 88px);
    }

    .left-sidebar,
    .right-sidebar {
      flex: 1;
    }

    .center-content {
      flex: 2;
      background-color: #ffffff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 800px;
      overflow-y: auto;
    }

    .account-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      padding: 10px;
      border-radius: 5px;
      transition: background-color 0.3s ease, transform 0.3s ease;
      border: 1px solid #ddd;
      margin-bottom: 10px;
    }

    .account-item:hover {
      background-color: #b2f0e8;
      transform: scale(1.02);
    }

    .account-item.checked {
      background-color: #008080;
      color: white;
    }

    .account-info {
      display: flex;
      flex-direction: column;
    }

    .account-check {
      margin-right: 10px;
    }

    .delete-btn {
      background-color: #ff4d4d;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    .delete-btn:hover {
      background-color: #e60000;
    }

    .footer {
      background-color: #f9f9f9;
      padding: 20px;
      text-align: center;
      border-top: 1px solid #ddd;
      margin-top: 20px;
    }

    .footer img {
      height: 20px;
      margin: 0 10px;
    }

    .footer .social-media img {
      height: 30px;
      margin: 0 5px;
    }

    .footer .footer-info {
      font-size: 12px;
      color: #666;
      margin: 10px 0;
    }

    @font-face {
      font-family: 'CustomFont';
      src: url('/fonts/Hana2-Medium.otf') format('opentype');
    }

    body {
      font-family: 'CustomFont', sans-serif;
    }
    .current-account-card {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .current-account-card h3 {
      margin: 0;
      font-size: 20px;
      margin-bottom: 10px;
      color: #008080;
    }

    .current-account-card p {
      margin: 5px 0;
    }

    .account-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      padding: 10px;
      border-radius: 5px;
      transition: background-color 0.3s ease, transform 0.3s ease;
      border: 1px solid #ddd;
      margin-bottom: 10px;
      background-color: #f0f0f0;
    }

    .account-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex-grow: 1;
      text-align: center;
    }

    .account-info p {
      margin: 5px 0;
    }

    .delete-btn {
      background-color: #ff4d4d;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    .delete-btn:hover {
      background-color: #e60000;
    }

    .footer-socials {
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    .footer-socials a {
      font-size: 40px; /* 소셜 미디어 아이콘 크기 */
      color: #333; /* 기본 색상을 어두운 회색으로 변경 */
      transition: color 0.3s ease; /* 색상 변화에 부드러운 전환 효과 적용 */
    }

    .footer-socials a:hover {
      color: #555; /* 호버 시 색상을 조금 더 밝은 회색으로 변경 */
    }
    .social-link i {
      transition: transform 0.3s ease;
    }

    .social-link i:hover {
      transform: scale(1.2); /* 아이콘 확대 효과 */
    }
  </style>
</head>
<body>
<div class="header">
  <!-- Header Content -->
  <div class="left-section">
    <img src="img/hana_logo.png" alt="로고">
    <div class="text-wrapper">하나 보험</div>
  </div>
  <div class="right-section">
    <div class="menu">
      <a href="/join-lists">내 보험</a>
      <a href="/product-list">보험 상품</a>
      <a href="/change-account">계좌 변경</a>
      <a href="/product-list">공사중</a>
    </div>
    <img src="img/main_search.png" class="main-search" alt="검색">
    <img src="img/all_menu_icon.png" class="all-menu-icon" alt="전체 메뉴">
    <a href="/logout" class="logout">로그아웃</a>
  </div>
</div>
<div class="header-mini-bar">
  <!-- Mini Bar Content -->
  <div class="menu">
    <!--    <a href="/">홈</a>-->
    <!--    <a href="/insurance-products">보험상품</a>-->
    <!--    <a href="/benefits">혜택</a>-->
    <!--    <a href="/claims">보상</a>-->
    <!--    <a href="/mypage">마이페이지</a>-->
    <!--    <a href="/customer-center">고객센터</a>-->
  </div>
</div>
<div class="main">
  <div class="center-content">
    <div class="left-sidebar"></div>
    <h2>결제 계좌 변경 </h2>
    <div id="currentAccountInfo">현재 계좌 정보가 여기에 표시됩니다.</div>
    <br>
    <div class="center-content">
      <h3>오픈뱅킹 보유계좌</h3>
      <!--    <a th:href="@{/api/insurance/accountinfo}">계좌통합조회</a>-->
      <div id="accountInfo"></div>
    </div>
    <div class="right-sidebar"></div>
  </div>
</div>
<div class="footer">
  <!-- Footer Content -->
  <div>
    <img src="img/hana_logo.png" alt="하나손해보험">
    <span class="footer-info">하나손해보험주식회사 | 대표이사: 배성완 | 사업자등록번호 107-86-24985</span>
    <span class="footer-info">서울특별시 종로구 창경궁로 117 (하나손해보험빌딩, 인의동) | TEL 02-6670-8400</span>
    <br>
    <span class="footer-info">©2023 Hana Insurance Co.,Ltd. All Rights Reserved.</span>
  </div>
  <div class="social-media">
<!--    <img src="img/social_youtube.png" alt="유튜브">-->
<!--    <img src="img/social_instagram.png" alt="인스타그램">-->
<!--    <img src="img/social_blog.png" alt="블로그">-->

    <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
    <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
    <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
  </div>
</div>
<input type="hidden" id="customerId" value="${customer.customerId}">


<script>
  function fetchCurrentAccount() {
    fetch(`/api/insurance/currentAccount`)
    .then(response => response.json())
    .then(accounts => {
      const currentAccountInfoDiv = document.getElementById('currentAccountInfo');
      if (accounts.length === 0) {
        currentAccountInfoDiv.textContent = '현재 계좌 정보가 없습니다.';
      } else {
        currentAccountInfoDiv.innerHTML = accounts.map(account => `
        <div class="current-account-card">
          <h3>현재 계좌 정보</h3>
          <p>기관: ${account.bankCode}</p>
          <p>계좌 번호: ${account.accountNo}</p>
          <p>계좌 명: ${account.accountName}</p>
        </div>
      `).join('');
      }
    })
    .catch(error => {
      console.error('계좌 정보를 불러오는 중 오류가 발생했습니다.', error);
      currentAccountInfoDiv.textContent = '계좌 정보를 불러올 수 없습니다.';
    });
  }

  document.addEventListener('DOMContentLoaded', function () {
    fetchCurrentAccount();
    fetch('/api/insurance/accountinfo')
    .then(response => response.json())
    .then(data => {
      const accountInfoDiv = document.getElementById('accountInfo');
      data.bankAccounts.forEach(account => {
        console.log(account)
        const accountDiv = document.createElement('div');
        accountDiv.className = 'account-item';
        accountDiv.innerHTML = `
          <div class="account-info">
            <p>기관: ${account.bankCodeStd}</p>
          <p>계좌 번호: ${account.accountNum}</p>
          <p>계좌 명: ${account.accountName}</p>
          </div>
        `;
        accountDiv.addEventListener('click', function () {
          saveAccountInfo(account);
        });
        accountInfoDiv.appendChild(accountDiv);
      });
    })
    .catch(error => {
      console.error('Failed to fetch account information:', error);
      document.getElementById('accountInfo').innerHTML = '<p>계좌 정보를 불러오는데 실패했습니다.</p>';
    });
  });

  function saveAccountInfo(account) {
    if (!confirm('계좌 정보를 변경하시겠습니까?')) {
      return; // 사용자가 취소를 누르면 함수 종료
    }

    const customerId = document.getElementById('customerId').value;

    const accountData = {
      accountNo: account.accountNum,
      accountName: account.accountName,
      bankCode: account.bankCodeStd,
      customerId: customerId
    };

    console.log('Sending account data:', accountData);

    fetch('/api/insurance/saveOrUpdateAccount', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(accountData)
    })
    .then(response => {
      console.log('Response status:', response.status);
      if (!response.ok) {
        throw new Error('Network response was not ok: ' + response.statusText);
      }
      return response.json();
    })
    .then(data => {
      alert('계좌 정보가 성공적으로 변경되었습니다.');
      fetchCurrentAccount(); // 계좌 정보 변경 후 현재 계좌 정보 갱신
    })
    .catch(error => {
      console.error('서버와의 통신 중 오류가 발생했습니다.', error);
      alert('변경 실패: ' + error.message);
    });
  }
</script>
</body>
</html>
